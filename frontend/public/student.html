<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Page</title>
    <link rel="stylesheet" href="student.css">
</head>
<body>
    <div class="header">
       
        <div class="student-info">
            <span id="student-name"></span>
            <button class="logout-btn" id="logout-btn">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="navbar">
            <button id="add-course-btn">Add Course</button>
            <button id="your-courses-btn">Your Courses</button>
            <button id="take-quiz-btn">Take Quiz</button> <!-- Button to show quiz section -->
        </div>

        <!-- Add Course Form -->
        <div id="add-course-form" class="form-container">
            <h2>Add a New Course</h2>
            <form id="course-form">
                <input type="text" id="course-name" placeholder="Course Name" required>
                <input type="number" id="course-credits" placeholder="Credits" required>
                <button type="submit">Submit</button>
            </form>
        </div>

        <!-- Your Courses -->
        <div id="your-courses-form" class="form-container">
            <h2>Your Courses</h2>
            <ul id="course-list"></ul>
        </div>

        <!-- Quiz Section -->
        <div id="quiz-section" class="form-container" style="display:none;">
            <h2>Quiz Game</h2>
            <button id="start-quiz-btn">Start Quiz</button> <!-- Button to start the quiz -->
            <div id="quiz-container" style="display:none;">
                <p id="question-text"></p>
                <ul id="options-list"></ul>
                <button id="submit-answer-btn">Submit Answer</button>
            </div>
            <div id="quiz-result" style="display:none;">
                <p>Your score: <span id="score"></span></p>
                <button id="retry-quiz-btn">Retry Quiz</button>
            </div>
        </div>

    </div>

    <!-- <script src="student.js"></script> -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-app.js";
        import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/9.10.0/firebase-database.js";

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyB95NgHgvgksnX3-MzcoQtXFRp3B5H2sJA",
            authDomain: "studentassistence-18f34.firebaseapp.com",
            databaseURL: "https://studentassistence-18f34-default-rtdb.firebaseio.com",
            projectId: "studentassistence-18f34",
            storageBucket: "studentassistence-18f34.appspot.com",
            messagingSenderId: "182727662059",
            appId: "1:182727662059:web:aa9fdd70eccfd24684a1ae"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // DOM Elements
        const studentNameElement = document.getElementById('student-name');
        const logoutBtn = document.getElementById('logout-btn');
        const addCourseBtn = document.getElementById('add-course-btn');
        const yourCoursesBtn = document.getElementById('your-courses-btn');
        const takeQuizBtn = document.getElementById('take-quiz-btn');
        const addCourseForm = document.getElementById('add-course-form');
        const yourCoursesForm = document.getElementById('your-courses-form');
        const courseForm = document.getElementById('course-form');
        const courseList = document.getElementById('course-list');
        const quizSection = document.getElementById('quiz-section');
        const startQuizBtn = document.getElementById('start-quiz-btn');
        const quizContainer = document.getElementById('quiz-container');
        const questionText = document.getElementById('question-text');
        const optionsList = document.getElementById('options-list');
        const submitAnswerBtn = document.getElementById('submit-answer-btn');
        const quizResult = document.getElementById('quiz-result');
        const scoreDisplay = document.getElementById('score');
        const retryQuizBtn = document.getElementById('retry-quiz-btn');

        let questions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let selectedAnswer = "";

        // Get logged-in student's data from localStorage
      // Get logged-in student's data from localStorage
const loggedInStudent = JSON.parse(localStorage.getItem('loggedInStudent'));
if (!loggedInStudent) {
    alert('Please log in first.');
    window.location.href = 'signup.html'; // Redirect if not logged in
} else {
    // Display the student's name in the span element
    const studentNameElement = document.getElementById('student-name');
    studentNameElement.textContent = ` ${loggedInStudent.name}`;
}

        // Logout
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('loggedInStudent');
            window.location.href = 'index.html';
            alert('Logged out successfully');
        });

        // Show/Hide Forms
        addCourseBtn.addEventListener('click', () => {
            addCourseForm.classList.add('active');
            yourCoursesForm.classList.remove('active');
            quizSection.style.display = 'none';
        });

        yourCoursesBtn.addEventListener('click', () => {
            yourCoursesForm.classList.add('active');
            addCourseForm.classList.remove('active');
            quizSection.style.display = 'none';
            fetchCourses();
        });

        // Show Quiz Section
        takeQuizBtn.addEventListener('click', () => {
            addCourseForm.classList.remove('active');
            yourCoursesForm.classList.remove('active');
            quizSection.style.display = 'block';
            fetchQuizQuestions();  // Load quiz questions
        });

        // Fetch Courses
        function fetchCourses() {
            const courseRef = ref(db, `students/${loggedInStudent.id}/courses`);
            onValue(courseRef, (snapshot) => {
                courseList.innerHTML = '';
                if (snapshot.exists()) {
                    const courses = snapshot.val();
                    Object.values(courses).forEach((course) => {
                        const li = document.createElement('li');
                        li.textContent = `${course.coursename} - ${course.credits} credits`;
                        courseList.appendChild(li);
                    });
                } else {
                    courseList.innerHTML = '<li>No courses found</li>';
                }
            });
        }

        // Add Course
        courseForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const courseName = document.getElementById('course-name').value.trim();
            const courseCredits = document.getElementById('course-credits').value;

            if (!courseName || !courseCredits) {
                alert('Please fill out all fields.');
                return;
            }

            const courseRef = ref(db, `students/${loggedInStudent.id}/courses`);
            push(courseRef, { coursename: courseName, credits: courseCredits })
                .then(() => {
                    alert('Course added successfully!');
                    courseForm.reset();
                    addCourseForm.classList.remove('active');
                })
                .catch((error) => alert('Error: ' + error.message));
        });

        // Fetch Quiz Questions
        async function fetchQuizQuestions() {
            const response = await fetch('https://opentdb.com/api.php?amount=5&type=multiple');
            const data = await response.json();
            questions = data.results;
            loadQuestion(currentQuestionIndex);
        }

        // Load Question and Options
        function loadQuestion(index) {
            const question = questions[index];
            questionText.textContent = question.question;
            optionsList.innerHTML = '';

            const options = [...question.incorrect_answers, question.correct_answer];
            shuffleArray(options);

            options.forEach((option) => {
                const li = document.createElement('li');
                li.textContent = option;
                li.addEventListener('click', () => selectAnswer(option));
                optionsList.appendChild(li);
            });
        }

        // Shuffle Array of Answers
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Select Answer
        function selectAnswer(answer) {
            selectedAnswer = answer;
            Array.from(optionsList.children).forEach((li) => {
                li.style.backgroundColor = li.textContent === selectedAnswer ? '#ddd' : '';
            });
        }

        // Submit Answer
        submitAnswerBtn.addEventListener('click', () => {
            if (selectedAnswer === "") {
                alert('Please select an answer');
                return;
            }

            const correctAnswer = questions[currentQuestionIndex].correct_answer;
            if (selectedAnswer === correctAnswer) {
                score++;
            }

            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                loadQuestion(currentQuestionIndex);
            } else {
                showQuizResult();
            }
        });

        // Show Quiz Result
        function showQuizResult() {
            quizContainer.style.display = 'none';
            quizResult.style.display = 'block';
            scoreDisplay.textContent = score;
        }

        // Retry Quiz
        retryQuizBtn.addEventListener('click', () => {
            score = 0;
            currentQuestionIndex = 0;
            quizResult.style.display = 'none';
            quizContainer.style.display = 'block';
            loadQuestion(currentQuestionIndex);
        });
    </script>
</body>
</html>
